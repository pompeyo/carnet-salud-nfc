<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Carnet de Salud Digital</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f6fa;
    margin: 0;
}
.card {
    max-width: 420px;
    margin: 40px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 24px;
}
h1 {
    text-align: center;
    color: #005baa;
}
.field {
    margin-bottom: 10px;
}
.label {
    font-weight: bold;
}
.timer {
    text-align: center;
    color: #b00020;
    margin-top: 10px;
    font-weight: bold;
}
.footer {
    text-align: center;
    margin-top: 20px;
    font-size: 12px;
    color: #777;
}
.hidden {
    display: none;
}
</style>
</head>

<body>

<div class="card">
<h1>ðŸªª Carnet de Salud Digital</h1>

<div id="contenido">
    <div class="field"><span class="label">Nombre:</span> <span id="nombre">â€”</span></div>
    <div class="field"><span class="label">DNI:</span> <span id="dni">â€”</span></div>
    <div class="field"><span class="label">Sexo:</span> <span id="sexo">â€”</span></div>
    <div class="field"><span class="label">Grupo sanguÃ­neo:</span> <span id="grupo">â€”</span></div>
    <div class="field"><span class="label">Alergias:</span> <span id="alergias">â€”</span></div>
    <div class="field"><span class="label">Enfermedades:</span> <span id="enfermedades">â€”</span></div>
</div>

<div id="mensaje" class="hidden">
    <p><strong>No hay datos disponibles.</strong></p>
    <p>Vuelva a escanear el carnet NFC.</p>
</div>

<div class="timer" id="timer"></div>

<div class="footer">
SALUDPOL Â· VisualizaciÃ³n temporal<br>
La sesiÃ³n se cierra automÃ¡ticamente
</div>
</div>

<script>
const SESSION_KEY = "nfc_session_activa";
const EXPIRACION_MS = 60000;

// Base de datos simulada
const DATA = {
  "04:61:00:48:24:02:89": {
    nombre: "PERCIAL YUYARIMA, MILAGRO DE JESUS",
    dni: "60985388",
    sexo: "FEMENINO",
    grupo: "O+",
    alergias: "Penicilina",
    enfermedades: "Diabetes, HipertensiÃ³n"
  },
  "04:81:44:45:24:02:89": {
    nombre: "CORDOVA CORDOVA, EDUARDO",
    dni: "43283561",
    sexo: "MASCULINO",
    grupo: "A+",
    alergias: "Ninguna conocida",
    enfermedades: "Asma leve"
  }
};

// Si ya hubo una sesiÃ³n â†’ bloquear
if (sessionStorage.getItem(SESSION_KEY)) {
    bloquear();
} else {
    iniciar();
}

function iniciar() {
    const params = new URLSearchParams(window.location.search);
    const uid = params.get("uid");

    if (!uid || !DATA[uid]) {
        bloquear();
        return;
    }

    sessionStorage.setItem(SESSION_KEY, "true");

    const d = DATA[uid];
    nombre.textContent = d.nombre;
    dni.textContent = d.dni;
    sexo.textContent = d.sexo;
    grupo.textContent = d.grupo;
    alergias.textContent = d.alergias;
    enfermedades.textContent = d.enfermedades;

    // Limpiar URL
    history.replaceState({}, document.title, location.pathname);

    iniciarTimer();
}

function bloquear() {
    document.getElementById("contenido").classList.add("hidden");
    document.getElementById("mensaje").classList.remove("hidden");
    iniciarTimer();
}

function iniciarTimer() {
    let restante = EXPIRACION_MS / 1000;
    timer.textContent = `Cierre automÃ¡tico en ${restante}s`;

    const interval = setInterval(() => {
        restante--;
        timer.textContent = `Cierre automÃ¡tico en ${restante}s`;

        if (restante <= 0) {
            clearInterval(interval);
            sessionStorage.clear();
            document.body.innerHTML = "<h2 style='text-align:center;margin-top:40px'>SesiÃ³n finalizada</h2>";
        }
    }, 1000);
}

// Evitar volver atrÃ¡s con datos
window.onpopstate = () => {
    location.reload();
};
</script>

</body>
</html>
